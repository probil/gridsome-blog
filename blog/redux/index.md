---
title: Використання Redux сховища як бази даних
date: 2020-07-29
summary: Ґільєрмо Рауч нещодавно твітнув це. Нумо розберімось що ж це означає
tags: []
originalArticle:
    url: https://hackernoon.com/shape-your-redux-store-like-your-database-98faa4754fd5
    title: Using the Redux Store Like a Database
    author: Nick Sweeting
cover:
    file: ./images/rotating-cube.gif
---
Я нещодавно проглядав деякі Javascript обговорення у чат-системі [RC](https://recurse.com/) і помітив чудове питання від [Кейт Рей](https://twitter.com/kraykray):

> Як структурувати дані в Redux сховищі?

Це питання є поширеним при використанні Redux, безперечно я неодноразово задавав його й собі. Відповідь, як правило, залежить від того, як я планую взаємодіяти зі своїми даними.

Є кілька речей які варто враховувати: чи часто я збираюся проходитись сховищем як по списку рядків? Чи потрібен швидкий `O(1)` доступ до окремих елементів?

На практиці я бачив кілька підходів, як правило, з деякими компромісами між часом доступу та простотою ітерації.

## Типові підходи

Якщо ви зберігаєте деякі дані де кожен елемент має ідентифікатор, можна формувати сховище як об'єкт або масив об'єктів.

### Масив пласких об'єктів `[{values}]`:

Найпоширеніший на сьогоднішні підхід серед тих що я бачив. Робить ітерацію простою, дозволяє зберігати дані в певному порядку, але нема можливості отримати доступ до певного елемента за `id` чи `name` без ітерації та фільтрації.

```js
categories: [
  { name: 'abs',  id: '32o8wafe', exercises: ['crunches', 'plank'] },
  { name: 'arms', id: 'oaiwefjo', exercises: [...] },
  { name: 'legs', id: 'aoijwfeo', exercises: [...] },
]
```

### Об'єкт з ключам-ідентифікаторами `{id: {values}}`:

Цей підхід дає вам швидкий `O(1)` доступ до кожного елемента, але нема можливості отримати доступ до `id` певного елемента під час ітерації за допомогою `Object.values()`.

```js
categories: {
  '32o8wafe': { name: 'abs',  exercises: ['crunches', 'plank'] },
  'oaiwefjo': { name: 'arms', exercises: [...] },
  '3oij2e3c': { name: 'legs', exercises: [...] },
}
```

```js
Object.values(categories).map(row => /* нема доступу до `id` звідси */)
// можна використати Object.entries, але синтаксис row.id не працюватиме
```

> #### Їжа для роздумів:
> Масиви та об'єкті [це одні й ті самі речі в JS](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array#Description).  
> (Хоча V8 використовує різні внутрішні подання для їх збереження)


## Структуруйте його як базу даних з індексом на id

На нашому шляху реалізації великого Redux додатка у [Monadical](https://monadical.com/), ми натрапили на інший підхід, який дає нам перевагу як простої ітерації з `Object.values` (`state.categories`) так і швидкого `O(1)` доступу до окремих елементів:

```js
categories: {
  '32o8wafe': { id: '32o8wafe', name: 'abs',  exercises: [...] },
  'oaiwefjo': { id: 'oaiwefjo', name: 'arms', exercises: [...] },
  '3oij2e3c': { id: '3oij2e3c', name: 'legs', exercises: [...] },
}
```

Зауважте, що `id` виступає як ключем рядка, та і властивістю самого рядка. Це невелике дублювання дає нам значну гнучкість у часі доступу. Цей підхід також сумісний з [нормалізованою](http://redux.js.org/docs/recipes/reducers/NormalizingStateShape.html) (також відомою як *пласка*) структурою, яку радить документація Redux.

Тепер можна працювати з `id` під час ітерації!

```js
Object.values(categories).map(cat => ({ id: cat.id, name: cat.name }))
```

Або витягнути будь-який окремий елемент через `id` миттєво:
```
categories['32o8wafe'].name // 'abs'
```

Ми надсилаємо наші дані фронтенду уже у такому форматі, тому нема потреби робити перетворення у формат `<id>: <значення>`. З бекенд-частини робити це легко, оскільки, дані ймовірніше всього дістаються з бази даних, де вже є поле `id`, яке можна використати як ключ.
